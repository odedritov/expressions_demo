var jsPsychAudioKeyboardResponse=function(o){"use strict";function c(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}const y=s=>{const e=new Set;do for(const t of Reflect.ownKeys(s))e.add([s,t]);while((s=Reflect.getPrototypeOf(s))&&s!==Object.prototype);return e};var _=(s,{include:e,exclude:t}={})=>{const a=i=>{const r=n=>typeof n=="string"?i===n:n.test(i);return e?e.some(r):t?!t.some(r):!0};for(const[i,r]of y(s.constructor.prototype)){if(r==="constructor"||!a(r))continue;const n=Reflect.getOwnPropertyDescriptor(i,r);n&&typeof n.value=="function"&&(s[r]=s[r].bind(s))}return s},m=c(_),P="2.1.0",u=(s,e,t)=>new Promise((a,i)=>{var r=l=>{try{p(t.next(l))}catch(d){i(d)}},n=l=>{try{p(t.throw(l))}catch(d){i(d)}},p=l=>l.done?a(l.value):Promise.resolve(l.value).then(r,n);p((t=t.apply(s,e)).next())});const f={name:"audio-keyboard-response",version:P,parameters:{stimulus:{type:o.ParameterType.AUDIO,default:void 0},choices:{type:o.ParameterType.KEYS,default:"ALL_KEYS"},prompt:{type:o.ParameterType.HTML_STRING,pretty_name:"Prompt",default:null},trial_duration:{type:o.ParameterType.INT,default:null},response_ends_trial:{type:o.ParameterType.BOOL,default:!0},trial_ends_after_audio:{type:o.ParameterType.BOOL,pretty_name:"Trial ends after audio",default:!1},response_allowed_while_playing:{type:o.ParameterType.BOOL,default:!0}},data:{response:{type:o.ParameterType.STRING},rt:{type:o.ParameterType.INT},stimulus:{type:o.ParameterType.STRING}},citations:{apa:"de Leeuw, J. R., Gilbert, R. A., & Luchterhandt, B. (2023). jsPsych: Enabling an Open-Source Collaborative Ecosystem of Behavioral Experiments. Journal of Open Source Software, 8(85), 5351. https://doi.org/10.21105/joss.05351 ",bibtex:'@article{Leeuw2023jsPsych, 	author = {de Leeuw, Joshua R. and Gilbert, Rebecca A. and Luchterhandt, Bj{\\" o}rn}, 	journal = {Journal of Open Source Software}, 	doi = {10.21105/joss.05351}, 	issn = {2475-9066}, 	number = {85}, 	year = {2023}, 	month = {may 11}, 	pages = {5351}, 	publisher = {Open Journals}, 	title = {jsPsych: Enabling an {Open}-{Source} {Collaborative} {Ecosystem} of {Behavioral} {Experiments}}, 	url = {https://joss.theoj.org/papers/10.21105/joss.05351}, 	volume = {8}, }  '}};class h{constructor(e){this.jsPsych=e,this.response={rt:null,key:null},m(this)}trial(e,t,a){return new Promise(i=>u(this,null,function*(){var r;this.finish=i,this.params=t,this.display=e,this.audio=yield this.jsPsych.pluginAPI.getAudioPlayer(t.stimulus),t.trial_ends_after_audio&&this.audio.addEventListener("ended",this.end_trial),t.prompt!==null&&(e.innerHTML=t.prompt),this.startTime=(r=this.jsPsych.pluginAPI.audioContext())==null?void 0:r.currentTime,t.response_allowed_while_playing?this.setup_keyboard_listener():t.trial_ends_after_audio||this.audio.addEventListener("ended",this.setup_keyboard_listener),t.trial_duration!==null&&this.jsPsych.pluginAPI.setTimeout(()=>{this.end_trial()},t.trial_duration),a(),this.audio.play()}))}end_trial(){this.jsPsych.pluginAPI.clearAllTimeouts(),this.audio.stop(),this.audio.removeEventListener("ended",this.end_trial),this.audio.removeEventListener("ended",this.setup_keyboard_listener),this.jsPsych.pluginAPI.cancelAllKeyboardResponses();var e={rt:this.response.rt,response:this.response.key,stimulus:this.params.stimulus};this.display.innerHTML="",this.finish(e)}after_response(e){this.response=e,this.params.response_ends_trial&&this.end_trial()}setup_keyboard_listener(){this.jsPsych.pluginAPI.useWebaudio?this.jsPsych.pluginAPI.getKeyboardResponse({callback_function:this.after_response,valid_responses:this.params.choices,rt_method:"audio",persist:!1,allow_held_key:!1,audio_context:this.jsPsych.pluginAPI.audioContext(),audio_context_start_time:this.startTime}):this.jsPsych.pluginAPI.getKeyboardResponse({callback_function:this.after_response,valid_responses:this.params.choices,rt_method:"performance",persist:!1,allow_held_key:!1})}simulate(e,t,a,i){return u(this,null,function*(){if(t=="data-only")return i(),this.simulate_data_only(e,a);if(t=="visual")return this.simulate_visual(e,a,i)})}simulate_data_only(e,t){return this.create_simulation_data(e,t)}simulate_visual(e,t,a){return u(this,null,function*(){const i=this.create_simulation_data(e,t),r=this.jsPsych.getDisplayElement(),n=()=>{i.rt!==null&&this.jsPsych.pluginAPI.pressKey(i.response,i.rt)};return yield this.trial(r,e,()=>{a(),e.response_allowed_while_playing?n():this.audio.addEventListener("ended",n)})})}create_simulation_data(e,t){const a={stimulus:e.stimulus,rt:this.jsPsych.randomization.sampleExGaussian(500,50,.006666666666666667,!0),response:this.jsPsych.pluginAPI.getValidKey(e.choices)},i=this.jsPsych.pluginAPI.mergeSimulationData(a,t);return this.jsPsych.pluginAPI.ensureSimulationDataConsistency(e,i),i}}return h.info=f,h}(jsPsychModule);
//# sourceMappingURL=https://unpkg.com/@jspsych/plugin-audio-keyboard-response@2.1.0/dist/index.browser.min.js.map
